{% import 'bootstrap/wtf.html' as wtf %}
{% extends "base.html" %}
{% block content %}

  <div class="row">
   <div class="col-md-6 col-sm-6 col-xs-12">
    <form method="post">
     <div class="form-group ">
      <label class="control-label " for="retailer">
       Select a Retailer
      </label>
      <select class="select form-control" id="retailer" name="retailer">
        <option>Select Retailer</option>
        {% for retailer in retailers%}
          <option value="{{retailer}}">{{retailer}}</option>
        {% endfor %}
      </select>
     </div>
     <div class="form-group ">
      <label class="control-label" for="category">
       Select a Category
      </label>
      <select class="select form-control" id="category" name="category">
      </select>
     </div>
    </form>
    <div id="container"></div>
   </div>
   <div class="col-md-6 col-sm-6 col-xs-12">
    <form method="post">
     <div class="form-group ">
      <label class="control-label " for="retailer2">
       Select a Retailer
      </label>
      <select class="select form-control" id="retailer2" name="retailer2">
        <option>Select Retailer</option>
        {% for retailer in retailers%}
          <option value="{{retailer}}">{{retailer}}</option>
        {% endfor %}
      </select>
     </div>
     <div class="form-group ">
      <label class="control-label" for="category2">
       Select a Category
      </label>
      <select class="select form-control" id="category2" name="category2">
      </select>
     </div>
    </form>
    <div id="container2"></div>
   </div>
  </div>


{% block footer %}
{{super()}}
{% endblock %}
</div> <!-- /container -->
{% endblock %}
{% block scripts %}
{{super()}}
<script type="text/javascript">
  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
  $('#retailer, #retailer2').change(function() {
    var retailer = $(this).val()
    if($(this).is('#retailer')){
      var selector = '#category'
    } else {
      var selector = '#category2'
    }
    if (retailer) {
      $.ajax({url: $SCRIPT_ROOT + "/get/categories",
              data: {'retailer': retailer},
              method: 'POST',
              success: function(result){
                $(selector).empty();
                for (index = 0; index < result['categories'].length; ++index) {
                  $(selector).append("<option>" + result['categories'][index] + "</option>");
                }
              }
          })
        }
      })
  $('#category, #category2').change(function() {
    var category = $(this).val()
    if($(this).is('#category')){
      var selector = '#container';
      var retailer = $("#retailer").val();
    } else {
      var selector = '#container2';
      var retailer = $("#retailer2").val();
    }
    $.ajax({url: $SCRIPT_ROOT + "/get/category/histogram",
            data: {'retailer': retailer, 'category': category},
            method: 'POST',
            success: function(data){
              var graph = $(selector);
              graph.html(data);
            },
           dataType: "html"
        })
    })
</script>
{% endblock %}
